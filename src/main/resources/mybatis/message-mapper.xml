<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  <mapper namespace="Message">
  
  	<insert id="msgProc">
  		insert into st.message values(st.message_seq.nextval,#{msg_sender},#{msg_receiver},sysdate,null,#{msg_title},#{msg_contents},#{msg_sender_name},#{msg_receiver_name})
  	</insert>
  	
  	<select id="msgInBoxList" resultType="kh.gw.dto.MessageDTO">
  		select st.message.*, nvl(to_char(msg_receive_date), '읽지않음') as msg_receive_date_str from st.message where msg_receiver = #{value} order by msg_seq desc
  	</select>
  	
  	<update id="readDate">
  		update st.message set msg_receive_date=sysdate where msg_seq=#{value}
  	</update>
  	
  	<select id="msgView" resultType="kh.gw.dto.MessageDTO">
  		select * from st.message where msg_seq = #{value}
  	</select>
  	
  	<delete id="msgDelete">
  		delete from st.message where msg_seq = #{value}
  	</delete>
  	
  	<select id="getLatestSeqById" resultType="int">
  		select max(msg_seq) from st.message where msg_sender=#{id} order by msg_seq desc
  	</select>
  	
  	<insert id="msgFiles">
  		insert into st.message_attached_files values(#{msg_seq},#{msg_ori_name},#{msg_saved_name})
  	</insert>
  	
  	<select id="attFilesAll" resultType="kh.gw.dto.Message_attached_filesDTO">
  		select * from st.message_attached_files where msg_seq = #{value}
  	</select>
  	
  	<select id="msgOutBoxList" resultType="kh.gw.dto.MessageDTO">
  		select st.message.*, nvl(to_char(msg_receive_date), '읽지않음') as msg_receive_date_str from st.message where msg_sender = #{value} order by msg_seq desc
  	</select>
  	
  </mapper>